#!/usr/bin/env python3

import pathlib
import sys

import pspace

TAIL_LINES = 20

info = {}
try:
    job_id = sys.argv[1]
except IndexError:
    info = pspace.get_last_info()
    try:
        job_id = info['job_info']['id']
    except KeyError:
        print("Can't determine job id.")
        exit(1)
try:
    last_tot_log_lines = info['pspace_info']['total_log_lines']
    line_start = last_tot_log_lines - TAIL_LINES
except KeyError:
    line_start = 0

job_info = pspace.get_job_info(job_id)
log_lines = pspace.get_log_lines(job_id, line_start=line_start)
total_log_lines = line_start + len(log_lines)
pspace.save_last_info(job_info, {'total_log_lines':total_log_lines})

for line in log_lines[-TAIL_LINES:]:
    print(line)
